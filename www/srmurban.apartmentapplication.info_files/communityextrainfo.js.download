var CommunityExtraInfo=function(){"use strict";var CommunityExtraInfo=function(attrs){this.attrs=attrs};CommunityExtraInfo.create=function(attrs){return new CommunityExtraInfo(attrs)};CommunityExtraInfo.prototype={start:function(){var params={format:"json"};if(typeof window.get247CV==="function"){params.cv=window.get247CV()}var call=$.getJSON("/api/v1/community_info/",params);call.success(function(data){var api_key=data.objects[0].api_key,has_dni_phone=data.objects[0].settings.has_dni_phone,phone_format=data.objects[0].settings.display_phone_number_format,fax_format=data.objects[0].settings.display_fax_number_format;params.api_key=api_key;var extra_info=$.getJSON("/api/v1/community_extra_info/",params);extra_info.success(function(data){this.office_hours=data.objects[0].office_hours.replace(/\r?\n/g,"<br>");this.fax=data.objects[0].fax;this.pet_policy=data.objects[0].pet_policy;this.address=data.objects[0].address;this.address2=data.objects[0].address2;this.refer_a_friend_text=data.objects[0].refer_a_friend_text;this.available_unit_count=data.objects[0].available_unit_count;this.sisters=data.objects[0].sisters;var phone;if(data.objects[0].referrer_phones&&data.objects[0].referrer_phones.length&&document.referrer){_.each(data.objects[0].referrer_phones,function(referrer_phone){if(document.referrer.indexOf(referrer_phone["domain"])!==-1){phone=referrer_phone["phone"]}})}if(window.location.search.length){var query_params=_.reduce(window.location.search.substr(1).split("&"),function(ret,kv){var param=kv.split("=");ret[param[0]]=decodeURIComponent(param[1]);return ret},{});_.each(data.objects[0].referrer_params,function(referrer_param){if(query_params[referrer_param.name]===referrer_param.value){phone=referrer_param.phone}})}if(!phone){phone=data.objects[0].phone}var display_phone=phone;var phoneForLink=/(1)?.*([\d]{3}).*([\d]{3}).*([\d]{4})/.exec(phone);if(!phoneForLink[1]){phoneForLink[1]="1"}phoneForLink=phoneForLink.slice(1);if(phone_format){var phone_part=phone.split("-");display_phone=phone_format.replace(/\d/g,function(s,key){return phone_part[s]})}if(!!data.objects[0].display_tty_on_api_phone){display_phone+=' <span class="tty-text">TTY: 711</span>'}$(".api-office_hours").html(this.office_hours);var display_fax=this.fax;if(fax_format){var fax_part=this.fax.split("-");display_fax=fax_format.replace(/\d/g,function(s,key){return fax_part[s]})}$(".api-fax").text(display_fax);$(".api-pet_policy").html(this.pet_policy);$(".api-address").text(this.address);$(".api-address2").text(this.address2);if(typeof LTS_ID==="undefined"){if(!has_dni_phone){$(".api-phone").html("<a class='phone-link' href='tel:+"+phoneForLink.join("")+"'>"+display_phone+"</a>")}$(document).on("click",".phone-link",function(){ga("send","event","Phone Number","click")})}if(this.refer_a_friend_text){$(".api-refer_a_friend_text").text(this.refer_a_friend_text)}if(this.available_unit_count<1){$(".api-availability_link").remove()}if(this.sisters.length&&$("#sister_communities_template").length){var sister_template=_.template($("#sister_communities_template").html());var renderedContent=sister_template({sisters:this.sisters});$("#sister_communities_container").html(renderedContent)}if(typeof window.communityExtraInfoCallBack==="function"){window.communityExtraInfoCallBack()}})})}};return CommunityExtraInfo}();